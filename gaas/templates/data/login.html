<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>GaaS Login</title>
    <link
        href="https://cdnjs.cloudflare.com/ajax/libs/milligram/1.1.0/milligram.css"
        integrity="sha256-bqbMG65J5kcnYP6BsVMLUsIfO0NDCQIM+sGQzzJ4Qa0="
        crossorigin="anonymous"
        rel="stylesheet"
    />
</head>
<body>
<div class="container">
    <h2 class="title">Login to GaaS</h2>
    <form action="#" id="login-form">
        <fieldset>
            <label for="login-username">Username</label>
            <input id="login-username" type="text">
            <label for="login-password">Password</label>
            <input id="login-password" type="password">
            <input id="login-button" class="button-primary" value="send" type="submit">
            <div id="login-error" class="container" style="display: none">Incorrect username or password.</div>
        </fieldset>
    </form>
</div>

<!-- superagent 3.0.0 -->
<script
    src="https://cdnjs.cloudflare.com/ajax/libs/superagent/3.0.0/superagent.min.js"
    integrity="sha256-m8kXJRap0QWyl4ZLRGUGDwgnmZOYGY0Vf6IQp/NSrjY="
    crossorigin="anonymous"
    type="application/javascript"
></script>
<!-- gaasKeys, gaasKeyStore, api -->
<script src="{{endpoints.console}}/scripts/gaas.js" type="text/javascript"></script>
<!-- login form -->
<script type="application/javascript">
    "use strict";
    var el = document.getElementById.bind(document);
    var $username = el("login-username");
    var $password = el("login-password");
    var $loginButton = el("login-button");
    var $loginStatus = el("login-error");

    $loginButton.removeAttribute("disabled");

    // Submit form against the API, not the console
    el("login-form").addEventListener("submit", function(event) {
        console.log("onsubmit fired");
        event.preventDefault();
        $loginButton.setAttribute("disabled", true);
        var username = $username.value,
            password = $password.value;

        var FAIL = console.log;
        api.login(username, password)
        .then(function () {
            console.log("logged in!");
            $loginButton.removeAttribute("disabled");
            $loginStatus.style.display = "none";
            window.location.href = "{{endpoints.console}}/console";
        })
        .catch(function (event) {
            $loginButton.removeAttribute("disabled");
            $username.value = "";
            $password.value = "";
            $loginStatus.style.display = "";
            FAIL(event);
        })
        .catch(FAIL);
    });
</script>

</body>
</html>
