#!/usr/bin/env python
import falcon

from wsgiref import simple_server
from config import api_endpoint, console_endpoint
from gaas.resources.console import FileRenderer

context = {
    "endpoints": {
        "api": api_endpoint.geturl(),
        "console": console_endpoint.geturl()
    },
    "webcrypto": {
        "databaseName": "MoldyDatabase",
        "databaseVersion": 1,
        "keyStoreName": "MoldyKeyStore",
        "metaStoreName": "MoldyMetaStore"
    }
}
renderer = FileRenderer(context)

api = application = falcon.API()
api.add_route("/login", renderer.static("login.html"))
api.add_route("/console", renderer.static("console.html"))
api.add_route("/_reset", renderer.static("_reset.html"))
api.add_route("/js/{filename}", renderer.dynamic("^.+\.js$"))
api.add_route("/css/{filename}", renderer.dynamic("^.+\.css$"))

httpd = simple_server.make_server(console_endpoint.hostname, console_endpoint.port, api)
print("Serving CONSOLE on {}".format(console_endpoint.port))
httpd.serve_forever()
